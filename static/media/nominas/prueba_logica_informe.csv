timestamp,role,operation,input,expected,observed,status,recommendation
2025-12-04T00:53:35.712435Z,anonymous,access_admin_panel,GET /admin/dashboard (sin autenticación),403 or redirect to login,"403 expected, but if session cookie forged admin access possible because SECRET_KEY is hardcoded",VULNERABLE,Mover SECRET_KEY a variable de entorno y rotarla; validar sesiones server-side; revisar cookies firmadas.
2025-12-04T00:53:35.712502Z,unauthenticated (registro),crear_usuario (payload incluye cargo='admin'),"POST /usuarios/create {rut, nombres, apellidos, cargo: 'admin', contrasena:'x'}",Rechazar cargo admin para registro público; solo admin puede asignar roles,Si la aplicación inserta directamente el JSON (mass-assignment) el usuario se crea con cargo 'admin' -> escalación de privilegios,VULNERABLE,Usar whitelist de campos; validar roles; solo admins pueden asignar cargos privilegiados.
2025-12-04T00:53:35.712641Z,any,login_password_hashing,campo 'contrasena' almacenado con blake2b?,Hashing resistente (argon2/bcrypt/scrypt) con salt único,Sistema usa blake2b (hash rápido) sin KDF específico detectado en bdd.py,VULNERABLE,Cambiar a Argon2 o bcrypt; usar salt por usuario; ajustar parámetros de trabajo.
2025-12-04T00:53:35.713188Z,admin or public reset,reset_password_assign_static_default,POST /usuarios/reset {rut},Generate one-time token and email; require change on first login,Assign static predictable default password,VULNERABLE,"Implement tokenized reset, email verification, require password change."
2025-12-04T00:53:35.713255Z,student,upload_avatar (filename '../../app.py'),multipart: file filename='../../app.py' content='...',Reject traversal; sanitize filename; accept only allowed extensions; rename with uuid,secure_filename present?,VULNERABLE,Usar werkzeug.utils.secure_filename + rename con UUID; validar MIME y tamaño; almacenar fuera de static si no es público.
2025-12-04T00:53:35.713361Z,any,generar_pdf_desde_plantilla_con_datos_usuario,campo nombre contiene '<script>..</script>' o HTML,HTML escapa contenido; no ejecutar scripts; PDF seguro,Se detectan llamadas a replace() para generar plantillas (posible replace directo sin escape),VULNERABLE,Migrar a Jinja2 con autoescape y placeholders; escapar inputs.
2025-12-04T00:53:35.713525Z,authenticated,POST endpoints without CSRF token,POST /alguna_ruta (from external site),CSRF token required; reject if missing,No CSRF protection detected,VULNERABLE,Habilitar CSRFProtect en la app y tokens en formularios.
2025-12-04T00:53:35.713640Z,user,access_by_id (ObjectId from user input),GET /talleres/<id> with malformed id or id enumeration,Validate id format; return 400 for invalid; check ownership/ACL,No ObjectId.is_valid check detected (possible exception handling only),VULNERABLE,Usar ObjectId.is_valid() before casting; check ownership and ACL.
2025-12-04T00:53:35.713700Z,dev/deploy,app.run(debug=True) present,start server without wsgi,debug=False in prod; use gunicorn/uwsgi,debug=True detected,VULNERABLE,Remove debug=True from production; use env var FLASK_ENV=production and run under WSGI.
2025-12-04T00:53:35.713831Z,developer,use_generic_except,many try/except blocks with bare except,Use specific exceptions and log; don't swallow errors,Generic except detected,VULNERABLE,Catch specific exceptions and log tracebacks with logger.exception().
2025-12-04T00:53:35.713877Z,profesor,update_usuario (payload includes role='admin'),"PUT /usuarios/123 {nombres:'X', cargo:'admin'}",Only admin can change cargo; reject unauthorized role change,If code does mass-assignment without whitelist -> possible escalation,VULNERABLE,Whitelist fields; check permissions server-side.
2025-12-04T00:53:35.713995Z,any,upload_large_file,multipart huge file 500MB,Reject by MAX_CONTENT_LENGTH or other quota,No upload size limit detected,VULNERABLE,Set MAX_CONTENT_LENGTH and check file sizes server-side.
2025-12-04T00:53:35.714113Z,attacker,forge_session_cookie,generate signed cookie using SECRET_KEY and gain admin session,Secret key secret; sessions server-validated; rotate keys,SECRET_KEY hardcoded detected,VULNERABLE,"Move SECRET_KEY to env, rotate keys, and invalidate existing sessions."
2025-12-04T00:53:35.714243Z,developer,utility_functions_consistency,calls to str_to_float may return dict or float,Utility functions return consistent types and raise exceptions on invalid input,str_to_float detected in code and earlier review indicated inconsistent returns,VULNERABLE,Reimplement utility functions to return single type or raise; add unit tests.
